

### JZ25 å¤æ‚é“¾è¡¨çš„å¤åˆ¶

---



> **å‰‘æŒ‡ Offer ç³»åˆ—**ğŸŒŸ
>
> *ç»™å²æœˆä»¥æ–‡æ˜ï¼Œè€Œä¸æ˜¯ç»™æ–‡æ˜ä»¥å²æœˆã€‚*



#### é¢˜ç›®æè¿°

---

è¾“å…¥ä¸€ä¸ªå¤æ‚é“¾è¡¨ï¼ˆæ¯ä¸ªèŠ‚ç‚¹ä¸­æœ‰èŠ‚ç‚¹å€¼ï¼Œä»¥åŠä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦ä¸€ä¸ªç‰¹æ®ŠæŒ‡é’ˆrandomæŒ‡å‘ä¸€ä¸ªéšæœºèŠ‚ç‚¹ï¼‰ï¼Œè¯·å¯¹æ­¤

é“¾è¡¨è¿›è¡Œæ·±æ‹·è´ï¼Œå¹¶è¿”å›æ‹·è´åçš„å¤´ç»“ç‚¹ã€‚ï¼ˆæ³¨æ„ï¼Œè¾“å‡ºç»“æœä¸­è¯·ä¸è¦è¿”å›å‚æ•°ä¸­çš„èŠ‚ç‚¹å¼•ç”¨ï¼Œå¦åˆ™åˆ¤é¢˜ç¨‹åºä¼šç›´æ¥è¿”å›ç©ºï¼‰



#### é¢˜è§£

---

```python
import copy

def clone(pHead):
    return copy.deepcopy(pHead)  # æ·±æ‹·è´
```



```python
def copy_random_list(head):
    def dfs(head):
        """ æ·±åº¦ä¼˜å…ˆéå†(DFS) """
        if not head:
            return
        if head in visited:
            return visited[head]
        copy = RandomListNode(head.label)
        visited[head] = copy
        copy.next = dfs(head.next)
        copy.random = dfs(head.random)
        return copy
    visited = {}
    return dfs(head)
```



```python
def copy_random_list(head):
    def bfs(head):
        """ å¹¿åº¦ä¼˜å…ˆéå†(BFS) """
        if not head:
            return head
        clone = RandomListNode(head.label)
        queue = deque()
        queue.append(head)
        visited[head] = clone
        while queue:
            tmp = queue.pop()
            if tmp.next and tmp.next not in visited:
                visited[tmp.next] = RandomListNode(tmp.next.label)
                queue.append(tmp.next)
            if tmp.random and tmp.random not in visited:
                visited[tmp.random] = RandomListNode(tmp.random.label)
                queue.append(tmp.random)
            visited[tmp].next = visited.get(tmp.next)
            visited[tmp].random = visited.get(tmp.random)
        return clone
    visited = {}
    return bfs(head)
```



```python
def copy_random_list(head):
    """ è¿­ä»£ """
    visited = {}

    def get_clone_node(node):
        if not node:
            return
        if node not in visited:
            visited[node] = RandomListNode(node.label)
        return visited[node]

    if not head:
        return head
    old_head = head
    new_head = RandomListNode(old_head.label)
    visited[old_head] = new_head

    while old_head:
        new_head.random = get_clone_node(old_head.random)
        new_head.next = get_clone_node(old_head.next)

        old_head = old_head.next
        new_head = new_head.next
    return visited[head]
```



```python
def copy_random_list(head):
    """ è¿­ä»£ä¼˜åŒ– """
    if not head:
        return head
    cur = head
    while cur:
        new_node = RandomListNode(cur.label)  # å¤åˆ¶ç»“ç‚¹
        new_node.next = cur.next
        cur.next = new_node  # å¤åˆ¶ç»“ç‚¹åœ¨ cur åé¢
        cur = new_node.next  # ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªç»“ç‚¹

    cur = head
    while cur:
        # å¤åˆ¶ç»“ç‚¹çš„ random ç»“ç‚¹ = å½“å‰ç»“ç‚¹çš„ random ç»“ç‚¹çš„ä¸‹ä¸€ä¸ªç»“ç‚¹
        cur.next.random = cur.random.next if cur.random else None
        cur = cur.next.next

    cur_old_list = head  # å°†ä¸¤ä¸ªé“¾è¡¨åˆ†å¼€
    cur_new_list = head.next
    new_head = head.next
    while cur_old_list:
        cur_old_list.next = cur_old_list.next.next
        cur_new_list.next = cur_new_list.next.next if cur_new_list.next else None
        cur_old_list = cur_old_list.next
        cur_new_list = cur_new_list.next
    return new_head
```

<img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gimshk3wuij30pc0ckgoo.jpg" style="zoom:50%;" />



**è€ƒå¯Ÿè¦ç‚¹**ğŸ¥ï¼šé“¾è¡¨ã€DFSã€BFSã€é€’å½’ã€è¿­ä»£

**è§£é¢˜æ€è·¯**ğŸ¬ï¼š**å›¾**çš„åŸºæœ¬å•å…ƒæ˜¯**é¡¶ç‚¹**ï¼Œé¡¶ç‚¹ä¹‹é—´çš„å…³è”æˆä¸º**è¾¹**ã€‚é¢˜ä¸­çš„é“¾è¡¨å¯ä»¥çœ‹æˆä¸€ä¸ªå›¾ã€‚

- **æ·±åº¦ä¼˜å…ˆæœç´¢**ï¼šDepth First Search, DFS
  - ä»å¤´ç»“ç‚¹ `head` å¼€å§‹æ‹·è´ï¼›å¦‚æœç»“ç‚¹å·²è¢«æ‹·è´ï¼Œåˆ™ä¸éœ€è¦é‡å¤æ‹·è´ï¼Œå¦åˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„ç»“ç‚¹æ‹·è´ï¼Œå¹¶å°†æ‹·è´è¿‡çš„ç»“ç‚¹ä¿å­˜åœ¨å“ˆå¸Œè¡¨ä¸­ï¼Œæ ¼å¼ `{åŸç»“ç‚¹ï¼šæ‹·è´ç»“ç‚¹}`ï¼›ä½¿ç”¨é€’å½’æ‹·è´æ‰€æœ‰çš„ `next` ç»“ç‚¹ï¼Œå†é€’å½’æ‹·è´æ‰€æœ‰çš„ `random` ç»“ç‚¹ã€‚
- **å¹¿åº¦ä¼˜å…ˆæœç´¢**ï¼šBreadth First Search, BFS
  - åˆ›å»ºå“ˆå¸Œè¡¨ä¿å­˜å·²æ‹·è´ç»“ç‚¹ï¼›åˆ›å»ºé˜Ÿåˆ—å¹¶å°†å¤´ç»“ç‚¹å…¥é˜Ÿï¼›å½“é˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œå¼¹å‡ºä¸€ä¸ªç»“ç‚¹ï¼Œè‹¥è¯¥ç»“ç‚¹çš„ `next` ç»“ç‚¹æœªè¢«æ‹·è´ï¼Œåˆ™æ‹·è´å¹¶åŠ å…¥é˜Ÿåˆ—ï¼ŒåŒç† `random` ç»“ç‚¹ã€‚
- **è¿­ä»£ä¼˜åŒ–**ï¼šå°†é“¾è¡¨æ‰©å±•ï¼Œåœ¨æ¯ä¸ªé“¾è¡¨ç»“ç‚¹çš„æ—è¾¹æ‹·è´ï¼Œ`A->B->C` å˜æˆ `A->A'->B->B'->C->C'`ï¼Œç„¶åå°†æ‹·è´çš„ç»“ç‚¹åˆ†ç¦»å‡ºæ¥ã€‚æ­¤æ—¶**ç©ºé—´å¤æ‚åº¦**ä¸º O(1).



**æ—¶é—´å¤æ‚åº¦**ğŸ‰ï¼šO(n)

**ç©ºé—´å¤æ‚åº¦**ğŸ­ï¼šO(n)

